<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تبدیل CSV به JSON</title>
</head>
<body>
    <h1>تبدیل گوگل شیت CSV به JSON</h1>
    <button onclick="fetchAndConvert()">تبدیل</button>
    <pre id="output"></pre>

    <script>
        async function fetchAndConvert() {
            const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTE-hwpcN_TUxhnUi-aoO04lZ0u05A88EHHfzNYoYNWjoF3oHyCJdM-_DS6NcS5jJZcObapU8tTCquK/pub?gid=0&single=true&output=csv";

            try {
                // دریافت محتوای CSV
                const response = await fetch(csvUrl);
                const csvText = await response.text();

                // تبدیل CSV به JSON
                const jsonData = csvToJson(csvText);

                // نمایش JSON در خروجی
                document.getElementById("output").textContent = JSON.stringify(jsonData, null, 2);
            } catch (error) {
                console.error("خطا در دریافت یا تبدیل داده‌ها:", error);
                alert("خطا در دریافت یا تبدیل داده‌ها");
            }
        }

        function csvToJson(csvText) {
            const rows = csvText.split("\n");
            const headers = rows[0].split(",");

            const groupedData = {};

            rows.slice(1).forEach(row => {
                const values = row.split(",");
                const item = {};
                headers.forEach((header, i) => {
                    item[header.trim()] = values[i] ? values[i].trim() : "";
                });

                const category = item["نام دسته بندی"];
                if (!groupedData[category]) {
                    groupedData[category] = []; // ایجاد آرایه جدید برای دسته‌بندی جدید
                }
                groupedData[category].push(item); // اضافه کردن آیتم به آرایه مربوط به دسته‌بندی
            });

            return groupedData; // برگرداندن داده‌های گروه‌بندی شده
        }
    </script>
</body>
</html>
